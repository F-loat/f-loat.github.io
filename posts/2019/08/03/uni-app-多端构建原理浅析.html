<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>uni-app 多端构建原理浅析 | F-loat</title>
    <meta name="description" content="This is my blog">
    <link rel="icon" href="/favicon.ico">
    
    <link rel="preload" href="/assets/css/0.styles.76163388.css" as="style"><link rel="preload" href="/assets/js/app.13c773d0.js" as="script"><link rel="preload" href="/assets/js/7.aa338464.js" as="script"><link rel="preload" href="/assets/js/19.87719627.js" as="script"><link rel="prefetch" href="/assets/js/1.7ffe3bb5.js"><link rel="prefetch" href="/assets/js/10.6e9ec98c.js"><link rel="prefetch" href="/assets/js/11.d5243634.js"><link rel="prefetch" href="/assets/js/12.5deedb1c.js"><link rel="prefetch" href="/assets/js/13.aa80443b.js"><link rel="prefetch" href="/assets/js/14.82cda088.js"><link rel="prefetch" href="/assets/js/15.862bd929.js"><link rel="prefetch" href="/assets/js/16.363566c8.js"><link rel="prefetch" href="/assets/js/17.6d6bb229.js"><link rel="prefetch" href="/assets/js/18.1bf0ac12.js"><link rel="prefetch" href="/assets/js/20.6c33d59d.js"><link rel="prefetch" href="/assets/js/3.b8ae24e9.js"><link rel="prefetch" href="/assets/js/4.7f1c7d95.js"><link rel="prefetch" href="/assets/js/5.22356adf.js"><link rel="prefetch" href="/assets/js/6.800b50c0.js"><link rel="prefetch" href="/assets/js/8.985c44df.js"><link rel="prefetch" href="/assets/js/9.e034cf66.js">
    <link rel="stylesheet" href="/assets/css/0.styles.76163388.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div id="vuepress-theme-meteorlxy"><header class="header" data-v-0539f1bd><div data-v-740e207b data-v-0539f1bd><nav class="navbar" data-v-740e207b><div class="container" data-v-740e207b><a href="/" class="router-link-active" data-v-740e207b><span class="navbar-site-name" data-v-740e207b>
          F-loat
        </span></a> <div class="navbar-toggler" data-v-740e207b><svg class="icon" style="font-size:1.2em;" data-v-740e207b data-v-740e207b><title data-v-740e207b data-v-740e207b>menu</title><use xlink:href="#icon-menu" data-v-740e207b data-v-740e207b></use></svg></div> <div class="navbar-links" data-v-740e207b><a href="/" class="navbar-link" data-v-740e207b>
            首页
          </a><a href="/posts/" class="navbar-link router-link-active" data-v-740e207b>
            文章
          </a><a href="/about/" class="navbar-link" data-v-740e207b>
            关于
          </a><a href="https://github.com/F-loat/f-loat.github.io" target="_blank" rel="noopener noreferrer" class="navbar-link" data-v-740e207b>
            GitHub
          </a></div></div></nav> <div class="navbar-holder" style="display:none;" data-v-740e207b></div></div> <div class="banner" data-v-98d6aa8c data-v-0539f1bd data-v-0539f1bd><div class="container" data-v-98d6aa8c><div class="center" data-v-98d6aa8c><h1 data-v-98d6aa8c data-v-0539f1bd>
          uni-app 多端构建原理浅析
        </h1></div></div></div></header> <div class="container clearfix show-aside" data-v-6e91a59a data-v-6e91a59a><main class="main" data-v-6e91a59a><div class="post" data-v-6e91a59a data-v-6e91a59a><section class="post-meta main-div" data-v-4e23451f><section class="post-date clearfix" data-v-4e23451f><span class="create-date" data-v-4e23451f>
      发布时间 : 2019-08-03
    </span> <span class="update-date" data-v-4e23451f>
      最后修改 : 2019-08-07
    </span></section> <section class="post-links" data-v-4e23451f><a href="/posts/2019/07/22/interview-03.html" class="post-link" data-v-4e23451f>
      上一篇 : 前端 100 问 (三)
    </a> <a href="/posts/2019/08/07/interview-04.html" class="post-link" data-v-4e23451f>
      下一篇 : 前端 100 问 (四)
    </a></section></section> <article class="main-div"><div class="post-content content content__default"><blockquote><p>uni-app 是一个使用 <a href="https://vuejs.org" target="_blank" rel="noopener noreferrer">Vue.js<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 开发所有前端应用的框架，开发者编写一套代码，可编译到 iOS、Android、H5、以及各种小程序等多个平台。即使不跨端，uni-app 同时也是更好的小程序开发框架。</p></blockquote> <h2 id="概述"><a href="#概述" aria-hidden="true" class="header-anchor">#</a> 概述</h2> <p>本文主要针对 uni-app 的构建逻辑进行介绍，即主要涉及 vue-cli 及 webpack 的相关知识，对其本身的运行逻辑不做深入讨论</p> <h2 id="项目结构"><a href="#项目结构" aria-hidden="true" class="header-anchor">#</a> 项目结构</h2> <p>uni-app 支持通过 <a href="https://uniapp.dcloud.io/quickstart?id=_1-%E9%80%9A%E8%BF%87-HBuilderX-%E5%8F%AF%E8%A7%86%E5%8C%96%E7%95%8C%E9%9D%A2" target="_blank" rel="noopener noreferrer">可视化界面<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>、<a href="https://uniapp.dcloud.io/quickstart?id=_2-%E9%80%9A%E8%BF%87vue-cli%E5%91%BD%E4%BB%A4%E8%A1%8C" target="_blank" rel="noopener noreferrer">vue-cli命令行<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 两种方式快速创建项目，通过 HbuilderX 创建的项目相当于只保留了常规 vue 项目的 src 目录</p> <ul><li>优点是，最大程度上屏蔽了各种构建配置及项目依赖的处理，项目极为简洁，且对新手非常友好</li> <li>缺点是，降低了开发者一定的自由度，例如不便于使用 vscode 之类的第三方编辑器，开发者无法自由控制依赖及无法微调构建配置等</li></ul> <p>两种方式创建的项目相互转换也较为简单，本文将以命令行创建的项目为主进行介绍，同时在必要时说明两者差异，具体文件结构如下</p> <div class="language- extra-class"><pre class="language-text"><code>project
├── dist
├── node_modules
├── public
├── src
│   ├── pages
│   │   └── index
│   │      └── index.vue
│   ├── static
│   ├── App.vue
│   ├── main.js
│   ├── manifest.json
│   ├── pages.json
│   └── uni.scss
├── .gitignore
├── babel.config.js
├── package.json
├── postcss.config.js
└── README.md
</code></pre></div><h2 id="依赖说明"><a href="#依赖说明" aria-hidden="true" class="header-anchor">#</a> 依赖说明</h2> <blockquote><p>本文基于以下版本依赖编写，下方依赖均采用 <a href="http://www.apache.org/licenses/LICENSE-2.0.html" target="_blank" rel="noopener noreferrer">Apache-2.0<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 开源协议</p></blockquote> <ul><li>dependencies 中的各项依赖为 uni-app 针对不同平台的运行时，主要用于抹平 UI 及 API 差异</li> <li>devDependencies 中的各项依赖为 uni-app 的构建插件，主要用于调整 webpack 配置及构建流程</li></ul> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;dependencies&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;@dcloudio/uni-app-plus&quot;</span><span class="token operator">:</span> <span class="token string">&quot;0.0.248&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;@dcloudio/uni-h5&quot;</span><span class="token operator">:</span> <span class="token string">&quot;0.7.3&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;@dcloudio/uni-mp-alipay&quot;</span><span class="token operator">:</span> <span class="token string">&quot;0.0.822&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;@dcloudio/uni-mp-baidu&quot;</span><span class="token operator">:</span> <span class="token string">&quot;0.0.852&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;@dcloudio/uni-mp-qq&quot;</span><span class="token operator">:</span> <span class="token string">&quot;0.0.106&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;@dcloudio/uni-mp-toutiao&quot;</span><span class="token operator">:</span> <span class="token string">&quot;0.0.346&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;@dcloudio/uni-mp-weixin&quot;</span><span class="token operator">:</span> <span class="token string">&quot;0.0.967&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;devDependencies&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;@dcloudio/uni-cli-shared&quot;</span><span class="token operator">:</span> <span class="token string">&quot;0.2.973&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 公共工具类函数</span>
    <span class="token property">&quot;@dcloudio/uni-template-compiler&quot;</span><span class="token operator">:</span> <span class="token string">&quot;0.9.180&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;@dcloudio/vue-cli-plugin-hbuilderx&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1.0.124&quot;</span><span class="token punctuation">,</span> <span class="token comment">// app-plus 相关逻辑处理</span>
    <span class="token property">&quot;@dcloudio/vue-cli-plugin-uni&quot;</span><span class="token operator">:</span> <span class="token string">&quot;0.9.500&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 构建核心</span>
    <span class="token property">&quot;@dcloudio/vue-cli-plugin-uni-optimize&quot;</span><span class="token operator">:</span> <span class="token string">&quot;0.1.4&quot;</span><span class="token punctuation">,</span> <span class="token comment">// h5 发行模式优化</span>
    <span class="token property">&quot;@dcloudio/webpack-uni-mp-loader&quot;</span><span class="token operator">:</span> <span class="token string">&quot;0.3.639&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 小程序单文件组件解析</span>
    <span class="token property">&quot;@dcloudio/webpack-uni-pages-loader&quot;</span><span class="token operator">:</span> <span class="token string">&quot;0.2.856&quot;</span> <span class="token comment">// pages.json 解析转换</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="构建命令"><a href="#构建命令" aria-hidden="true" class="header-anchor">#</a> 构建命令</h2> <h3 id="uni-app-构建命令"><a href="#uni-app-构建命令" aria-hidden="true" class="header-anchor">#</a> uni-app 构建命令</h3> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token comment"># h5 平台的开发模式</span>
cross-env NODE_ENV<span class="token operator">=</span>development UNI_PLATFORM<span class="token operator">=</span>h5 vue-cli-service uni-serve
<span class="token comment"># 其他平台的开发模式</span>
cross-env NODE_ENV<span class="token operator">=</span>development UNI_PLATFORM<span class="token operator">=</span>platform vue-cli-service uni-build --watch

<span class="token comment"># 所有平台的生产模式</span>
cross-env NODE_ENV<span class="token operator">=</span>production UNI_PLATFORM<span class="token operator">=</span>platform vue-cli-service uni-build
</code></pre></div><p>uni-app 的构建基于 vue-cli 的插件体系开发而成，可以看到，在构建命令中主要做了以下两件事</p> <ul><li>对 <code>NODE_ENV</code> 及 <code>UNI_PLATFORM</code> 两个环境变量进行设置</li> <li>调用了 <code>vue-cli-service uni-*</code> 这一命令</li></ul> <h3 id="vue-cli-插件简介"><a href="#vue-cli-插件简介" aria-hidden="true" class="header-anchor">#</a> vue-cli 插件简介</h3> <blockquote><p>仅对 vue-cli 的 Service 插件做简单介绍，完整文档可以点击<a href="https://cli.vuejs.org/zh/dev-guide/plugin-dev.html" target="_blank" rel="noopener noreferrer">这里<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>查看</p></blockquote> <p>使用 vue-cli 初始化的项目，会在局部安装 <code>@vue/cli-service</code>，暴露出以下命令</p> <div class="language-sh extra-class"><pre class="language-sh"><code>vue-cli-service <span class="token operator">&lt;</span>command<span class="token operator">&gt;</span> <span class="token punctuation">[</span><span class="token punctuation">..</span>.args<span class="token punctuation">]</span>
</code></pre></div><p>每当调用 <code>vue-cli-service</code> 命令时，会自动加载 <code>package.json</code> 中所有名为 <code>vue-cli-plugin-&lt;name&gt;</code> 包中的 service 插件 (即 index.js)，service 插件可以修改 webpack 的配置及注入新的命令，上文中的 <code>uni-serve</code>，<code>uni-build</code> 及 <code>@vue/cli-service</code> 内建的 <a href="https://github.com/vuejs/vue-cli/blob/dev/packages/%40vue/cli-service/lib/commands/serve.js" target="_blank" rel="noopener noreferrer"><code>serve</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 等命令均是通过此方式注入</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// @dcloudio/vue-cli-plugin-uni/index.js</span>
<span class="token keyword">const</span> initServeCommand <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./commands/serve'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> initBuildCommand <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./commands/build'</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">api<span class="token punctuation">,</span> options</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">initServeCommand</span><span class="token punctuation">(</span>api<span class="token punctuation">,</span> options<span class="token punctuation">)</span>
  <span class="token function">initBuildCommand</span><span class="token punctuation">(</span>api<span class="token punctuation">,</span> options<span class="token punctuation">)</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>

<span class="token comment">// @dcloudio/vue-cli-plugin-uni/commands/serve.js</span>
module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">api<span class="token punctuation">,</span> options</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  api<span class="token punctuation">.</span><span class="token function">registerCommand</span><span class="token punctuation">(</span><span class="token string">'uni-serve'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    description<span class="token punctuation">:</span> <span class="token string">'start development server'</span><span class="token punctuation">,</span>
    usage<span class="token punctuation">:</span> <span class="token string">'vue-cli-service uni-serve [options] [entry]'</span><span class="token punctuation">,</span>
    options<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      <span class="token string">'--open'</span><span class="token punctuation">:</span> <span class="token template-string"><span class="token string">`open browser on server start`</span></span><span class="token punctuation">,</span>
      <span class="token string">'--copy'</span><span class="token punctuation">:</span> <span class="token template-string"><span class="token string">`copy url to clipboard on server start`</span></span><span class="token punctuation">,</span>
      <span class="token string">'--mode'</span><span class="token punctuation">:</span> <span class="token template-string"><span class="token string">`specify env mode (default: development)`</span></span><span class="token punctuation">,</span>
      <span class="token string">'--host'</span><span class="token punctuation">:</span> <span class="token template-string"><span class="token string">`specify host (default: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>defaults<span class="token punctuation">.</span>host<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">)`</span></span><span class="token punctuation">,</span>
      <span class="token string">'--port'</span><span class="token punctuation">:</span> <span class="token template-string"><span class="token string">`specify port (default: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>defaults<span class="token punctuation">.</span>port<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">)`</span></span><span class="token punctuation">,</span>
      <span class="token string">'--https'</span><span class="token punctuation">:</span> <span class="token template-string"><span class="token string">`use https (default: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>defaults<span class="token punctuation">.</span>https<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">)`</span></span><span class="token punctuation">,</span>
      <span class="token string">'--public'</span><span class="token punctuation">:</span> <span class="token template-string"><span class="token string">`specify the public network URL for the HMR client`</span></span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">args</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token comment">/*...*/</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// @dcloudio/vue-cli-plugin-uni/commands/build.js</span>
module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">api<span class="token punctuation">,</span> options</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  api<span class="token punctuation">.</span><span class="token function">registerCommand</span><span class="token punctuation">(</span><span class="token string">'uni-build'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    description<span class="token punctuation">:</span> <span class="token string">'build for production'</span><span class="token punctuation">,</span>
    usage<span class="token punctuation">:</span> <span class="token string">'vue-cli-service uni-build [options]'</span><span class="token punctuation">,</span>
    options<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      <span class="token string">'--watch'</span><span class="token punctuation">:</span> <span class="token template-string"><span class="token string">`watch for changes`</span></span><span class="token punctuation">,</span>
      <span class="token string">'--minimize'</span><span class="token punctuation">:</span> <span class="token template-string"><span class="token string">`Tell webpack to minimize the bundle using the TerserPlugin.`</span></span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">args</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token comment">/*...*/</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="核心逻辑"><a href="#核心逻辑" aria-hidden="true" class="header-anchor">#</a> 核心逻辑</h2> <p><code>@dcloudio/vue-cli-plugin-uni</code> 是 uni-app 整个构建体系的核心，主要文件结构如下</p> <div class="language- extra-class"><pre class="language-text"><code>@dcloudio/vue-cli-plugin-uni
├── commands
│   ├── build.js
│   ├── info.js
│   └── servr.js
├── lib
│   ├── app-plus
│   ├── h5
│   ├── mp-alipay
│   ├── mp-baidu
│   ├── ...
│   └── mp.js
├── packages
│   ├── @megalo
│   ├── h5-vue
│   ├── mp-vue
│   ├── mpvue
│   ├── ...
│   └── webpack-scoped-loader
├── util
├── generator.js
├── index.js
└── ui.js
</code></pre></div><p>执行 <code>vue-cli-service</code> 后，自动调用 <code>index.js</code>，进行以下主要处理步骤</p> <ul><li>注册构建命令</li> <li>初始化环境变量</li> <li>合并 <code>libs</code> 中的目标平台构建配置</li></ul> <blockquote><p>通过 <code>UNI_PLATFORM</code> 控制引用的配置文件，但实际上 App 及各小程序平台均直接使用了 <code>lib/mp.js</code></p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// @dcloudio/vue-cli-plugin-uni/index.js</span>
<span class="token keyword">const</span> platformOptions <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./lib/'</span> <span class="token operator">+</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">UNI_PLATFORM</span><span class="token punctuation">)</span>

<span class="token comment">// @dcloudio/vue-cli-plugin-uni/lib/app-plus.js</span>
<span class="token keyword">const</span> mp <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../mp'</span><span class="token punctuation">)</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> mp
</code></pre></div><ul><li>修改 alias，loaders 及 plugins 等配置</li></ul> <blockquote><p>通过 alias 配置将 vue 等第三方依赖链接到 <code>packages</code> 目录中的修改版本</p></blockquote> <h2 id="构建入口"><a href="#构建入口" aria-hidden="true" class="header-anchor">#</a> 构建入口</h2> <blockquote><p>构建入口是 webpack 整个构建流程的起始，uni-app 对于构建入口的处理也较为巧妙</p></blockquote> <h3 id="h5"><a href="#h5" aria-hidden="true" class="header-anchor">#</a> H5</h3> <p>普通 vue 项目的构建入口相对比较简单，整个应用只需要一个入口文件即可</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// @dcloudio/uni-cli-shared/lib/pages.js</span>
<span class="token keyword">function</span> <span class="token function">getMainEntry</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>mainEntry<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    mainEntry <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">existsSync</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">UNI_INPUT_DIR</span><span class="token punctuation">,</span> <span class="token string">'main.ts'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token string">'main.ts'</span> <span class="token punctuation">:</span> <span class="token string">'main.js'</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> mainEntry
<span class="token punctuation">}</span>

<span class="token comment">// @dcloudio/vue-cli-plugin-uni/lib/h5/index.js</span>
<span class="token keyword">const</span> vueConfig <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  pages<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    index<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      entry<span class="token punctuation">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">UNI_INPUT_DIR</span><span class="token punctuation">,</span> <span class="token function">getMainEntry</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token comment">// ...</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="其他平台"><a href="#其他平台" aria-hidden="true" class="header-anchor">#</a> 其他平台</h3> <p>接触过 <a href="https://github.com/Meituan-Dianping/mpvue" target="_blank" rel="noopener noreferrer">mpvue<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 或者 <a href="https://github.com/kaola-fed/megalo" target="_blank" rel="noopener noreferrer">megalo<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 的同学可能清楚，对于小程序的构建，每个页面都需要单独的一个入口文件，且入口文件内容基本一致，存在一定的冗余，这两个框架也都有相应的优化措施</p> <ul><li>mpvue 可以通过 <a href="https://github.com/F-loat/mpvue-entry" target="_blank" rel="noopener noreferrer">mpvue-entry<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 实现单一入口，并在 <code>app.json</code> 中统一配置各页面的 config</li> <li>megalo 则在 <a href="http://megalojs.org/#/basic/file?id=%E4%BC%98%E5%8C%96%E7%BB%93%E6%9E%84" target="_blank" rel="noopener noreferrer">@megalo/target<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 的 0.4.10 后的版本直接支持了以 vue 文件作为入口，页面的 config 同样在 vue 文件中配置</li></ul> <p>而 uni-app 的处理方式与 mpvue 较为一致，但实现上优雅很多，uni-app 所有页面的 config 均在 <code>pages.json</code> 中配置，构建入口均为 <code>src/main.js</code> 这个文件，通过传入不同的参数配合自定义 loader 来实现对不同页面的构建，同时根据构建模式的不同会输出三种不同的入口内容</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// @dcloudio/vue-cli-plugin-uni/lib/mp.js</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token function">webpackConfig</span> <span class="token punctuation">(</span><span class="token parameter">webpackConfig</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
    <span class="token function">parseEntry</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment">// ...</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      <span class="token comment">// ...</span>
      <span class="token function">entry</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> process<span class="token punctuation">.</span><span class="token constant">UNI_ENTRY</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token comment">// ...</span>
      module<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        rules<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
          <span class="token comment">// 自定义 main.js 解析 loader</span>
          test<span class="token punctuation">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">UNI_INPUT_DIR</span><span class="token punctuation">,</span> <span class="token function">getMainEntry</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          use<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
            loader<span class="token punctuation">:</span> <span class="token string">'@dcloudio/webpack-uni-mp-loader/lib/main'</span>
          <span class="token punctuation">}</span><span class="token punctuation">]</span>
        <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token comment">// ...</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// @dcloudio/uni-cli-shared/lib/pages.js</span>
<span class="token keyword">function</span> <span class="token function">parseEntry</span> <span class="token punctuation">(</span><span class="token parameter">pagesJson</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  process<span class="token punctuation">.</span><span class="token constant">UNI_ENTRY</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token string">'common/main'</span><span class="token punctuation">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">UNI_INPUT_DIR</span><span class="token punctuation">,</span> <span class="token function">getMainEntry</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// ...</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>pagesJson<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    pagesJson <span class="token operator">=</span> <span class="token function">getPagesJson</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  pagesJson<span class="token punctuation">.</span>pages<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">page</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// key 为 pages/index/index</span>
    <span class="token comment">// value 为 绝对路径 file:/project/src/main.js?{&quot;page&quot;:&quot;pages%2Findex%2Findex&quot;}</span>
    process<span class="token punctuation">.</span><span class="token constant">UNI_ENTRY</span><span class="token punctuation">[</span>page<span class="token punctuation">.</span>path<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">getMainJsPath</span><span class="token punctuation">(</span>page<span class="token punctuation">.</span>path<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>

<span class="token comment">// @dcloudio/webpack-uni-mp-loader/lib/main.js</span>
module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">content</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 自定义组件模式</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">UNI_USING_COMPONENTS</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./main-new'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> content<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// template 模式</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>resourceQuery<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">UNI_PLATFORM</span> <span class="token operator">===</span> <span class="token string">'mp-weixin'</span> <span class="token operator">||</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">UNI_PLATFORM</span> <span class="token operator">===</span> <span class="token string">'app-plus'</span><span class="token punctuation">)</span>
        <span class="token operator">?</span> <span class="token function">getMPVuePageFactoryMainJsCode</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token function">getNormalMainJsCode</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token comment">// 主入口，会做一些全局组件的解析</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">getNormalMainJsCode</span> <span class="token punctuation">(</span><span class="token parameter">params</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 常规页面入口文件</span>
  <span class="token keyword">return</span> <span class="token template-string"><span class="token string">`import App from './</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token function">normalizePath</span><span class="token punctuation">(</span>params<span class="token punctuation">.</span>page<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.vue'
import Vue from 'vue'
App.mpType='page'
const app = new Vue(App)
app.$mount()`</span></span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">getMPVuePageFactoryMainJsCode</span> <span class="token punctuation">(</span><span class="token parameter">params</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 使用 mpvue-page-factory 解决 mpvue#140</span>
  <span class="token keyword">return</span> <span class="token template-string"><span class="token string">`import pageFactory from 'mpvue-page-factory'
    import App from './</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token function">normalizePath</span><span class="token punctuation">(</span>params<span class="token punctuation">.</span>page<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.vue'
    Page(pageFactory(App))`</span></span>
<span class="token punctuation">}</span>

<span class="token comment">// @dcloudio/webpack-uni-mp-loader/lib/main-new.js</span>
module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">content</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>resourceQuery<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
    <span class="token keyword">return</span> <span class="token template-string"><span class="token string">`
import Vue from 'vue'            
import Page from './</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token function">normalizePath</span><span class="token punctuation">(</span>params<span class="token punctuation">.</span>page<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>ext<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">'
createPage(Page)
`</span></span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span><span class="token comment">/*...*/</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="公共配置"><a href="#公共配置" aria-hidden="true" class="header-anchor">#</a> 公共配置</h2> <table><thead><tr><th style="text-align:center;">环境变量</th> <th style="text-align:center;">典型值</th> <th style="text-align:center;">说明</th></tr></thead> <tbody><tr><td style="text-align:center;">NODE_ENV</td> <td style="text-align:center;"><code>'development'</code></td> <td style="text-align:center;">构建模式</td></tr> <tr><td style="text-align:center;">UNI_PLATFORM</td> <td style="text-align:center;"><code>'mp-weixin'</code></td> <td style="text-align:center;">构建平台</td></tr> <tr><td style="text-align:center;">UNI_INPUT_DIR</td> <td style="text-align:center;"><code>'file:/project/src'</code></td> <td style="text-align:center;">输入目录</td></tr> <tr><td style="text-align:center;">UNI_OUTPUT_DIR</td> <td style="text-align:center;"><code>'file:/project/dist'</code></td> <td style="text-align:center;">输出目录</td></tr> <tr><td style="text-align:center;">UNI_OUTPUT_TMP_DIR</td> <td style="text-align:center;"><code>'file:/project/.tmp/app-plus'</code></td> <td style="text-align:center;">缓存目录</td></tr> <tr><td style="text-align:center;">UNI_CLI_CONTEXT</td> <td style="text-align:center;"><code>'file:/project'</code></td> <td style="text-align:center;">项目根目录</td></tr> <tr><td style="text-align:center;">UNI_USING_COMPONENTS</td> <td style="text-align:center;"><code>true</code></td> <td style="text-align:center;">vue 编译模式</td></tr> <tr><td style="text-align:center;">UNI_USING_NVUES</td> <td style="text-align:center;"><code>false</code></td> <td style="text-align:center;">-</td></tr> <tr><td style="text-align:center;">UNI_USING_NVUE_COMPILER</td> <td style="text-align:center;"><code>false</code></td> <td style="text-align:center;">nvue 编译模式</td></tr> <tr><td style="text-align:center;">UNI_USING_V8</td> <td style="text-align:center;"><code>true</code></td> <td style="text-align:center;">-</td></tr> <tr><td style="text-align:center;">UNI_OPT_COMPONENT</td> <td style="text-align:center;"><code>true</code></td> <td style="text-align:center;">h5 优化</td></tr> <tr><td style="text-align:center;">UNI_OPT_PREFETCH</td> <td style="text-align:center;"><code>true</code></td> <td style="text-align:center;">h5 优化</td></tr> <tr><td style="text-align:center;">UNI_OPT_PRELOAD</td> <td style="text-align:center;"><code>true</code></td> <td style="text-align:center;">h5 优化</td></tr> <tr><td style="text-align:center;">VUE_APP_DEBUG</td> <td style="text-align:center;"><code>false</code></td> <td style="text-align:center;">debug 模式</td></tr> <tr><td style="text-align:center;">VUE_APP_PLATFORM</td> <td style="text-align:center;">同 <code>UNI_PLATFORM</code></td> <td style="text-align:center;">构建平台</td></tr></tbody></table> <p>以上变量主要用于构建时进行各种判断，从而对构建配置进行所需的修改，稍加了解对代码的阅读会有一定帮助，部分变量可在 <code>manifest.json</code> 中配置，部分可通过外部环境变量覆盖</p> <p>客户端侧各平台均能访问的环境变量仅有 <code>BASE_URL</code>，<code>NODE_ENV</code>，<code>VUE_APP_PLATFORM</code> 及 <code>UNI_ENV</code>，其中前三个是 vue-cli <a href="https://cli.vuejs.org/zh/guide/mode-and-env.html#%E5%9C%A8%E5%AE%A2%E6%88%B7%E7%AB%AF%E4%BE%A7%E4%BB%A3%E7%A0%81%E4%B8%AD%E4%BD%BF%E7%94%A8%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F" target="_blank" rel="noopener noreferrer">自动注入<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>的，最后一个由 <code>@dcloudio/vue-cli-plugin-uni</code> 注入，值同 <code>UNI_PLATFORM</code>，同时 uni-app 官方也不推荐使用环境变量来判断不同平台，而是使用<a href="https://uniapp.dcloud.io/platform" target="_blank" rel="noopener noreferrer">条件编译<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h3 id="alias"><a href="#alias" aria-hidden="true" class="header-anchor">#</a> Alias</h3> <ul><li>将 <code>template-compiler</code> 指向修订后的版本，这两个包会在构建过程中调用，所以需要借助 <code>module-alias</code> 进行处理</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// @dcloudio/vue-cli-plugin-uni/index.js</span>
<span class="token keyword">const</span> moduleAlias <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'module-alias'</span><span class="token punctuation">)</span>

moduleAlias<span class="token punctuation">.</span><span class="token function">addAlias</span><span class="token punctuation">(</span><span class="token string">'@megalo/template-compiler'</span><span class="token punctuation">,</span> <span class="token string">'@dcloudio/vue-cli-plugin-uni/packages/@megalo/template-compiler'</span><span class="token punctuation">)</span>
moduleAlias<span class="token punctuation">.</span><span class="token function">addAlias</span><span class="token punctuation">(</span><span class="token string">'mpvue-template-compiler'</span><span class="token punctuation">,</span> <span class="token string">'@dcloudio/vue-cli-plugin-uni/packages/mpvue-template-compiler'</span><span class="token punctuation">)</span>
</code></pre></div><ul><li>webpack 的 alias 配置中，vue 指向了 <code>getPlatformVue()</code> 这个函数，当使用<a href="https://ask.dcloud.net.cn/article/35843" target="_blank" rel="noopener noreferrer">自定义组件模式<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>时，会始终返回 <code>uniRuntime</code>，否则默认情况如下表</li></ul> <table><thead><tr><th style="text-align:center;">运行时</th> <th style="text-align:center;">平台</th></tr></thead> <tbody><tr><td style="text-align:center;">vueRuntime</td> <td style="text-align:center;"><code>h5</code></td></tr> <tr><td style="text-align:center;">mpvueRuntime</td> <td style="text-align:center;"><code>app-plus, mp-qq, mp-weixin</code></td></tr> <tr><td style="text-align:center;">megaloRuntime</td> <td style="text-align:center;"><code>mp-baidu, mp-alipay, mp-toutiao</code></td></tr></tbody></table> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// @dcloudio/vue-cli-plugin-uni/index.js</span>
module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">api<span class="token punctuation">,</span> options</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  api<span class="token punctuation">.</span><span class="token function">configureWebpack</span><span class="token punctuation">(</span><span class="token parameter">webpackConfig</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
    <span class="token keyword">return</span> <span class="token function">merge</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      resolve<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        alias<span class="token punctuation">:</span> <span class="token punctuation">{</span>
          <span class="token string">'@'</span><span class="token punctuation">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">UNI_INPUT_DIR</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token string">'vue$'</span><span class="token punctuation">:</span> <span class="token function">getPlatformVue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token string">'uni-pages'</span><span class="token punctuation">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">UNI_INPUT_DIR</span><span class="token punctuation">,</span> <span class="token string">'pages.json'</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token comment">// ...</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token comment">// ...</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> platformWebpackConfig<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>

<span class="token comment">// @dcloudio/uni-cli-shared/lib/platform.js</span>
<span class="token keyword">const</span> uniRuntime <span class="token operator">=</span> <span class="token string">'@dcloudio/vue-cli-plugin-uni/packages/mp-vue'</span>
<span class="token keyword">const</span> mpvueRuntime <span class="token operator">=</span> <span class="token string">'@dcloudio/vue-cli-plugin-uni/packages/mpvue'</span>
<span class="token keyword">const</span> megaloRuntime <span class="token operator">=</span> <span class="token string">'@dcloudio/vue-cli-plugin-uni/packages/megalo'</span>

<span class="token keyword">const</span> <span class="token constant">PLATFORMS</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token string">'h5'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
    global<span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
    exts<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    vue<span class="token punctuation">:</span> <span class="token string">'@dcloudio/vue-cli-plugin-uni/packages/h5-vue'</span><span class="token punctuation">,</span>
    compiler<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    megalo<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    subPackages<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    cssVars<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      <span class="token string">'--status-bar-height'</span><span class="token punctuation">:</span> <span class="token string">'0px'</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token function">getPlatformVue</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">UNI_USING_COMPONENTS</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> uniRuntime
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> platform<span class="token punctuation">.</span>vue
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="loaders"><a href="#loaders" aria-hidden="true" class="header-anchor">#</a> Loaders</h3> <ul><li>sass-loader</li></ul> <p>uni-app 会自动判断是否存在 <code>src/uni.scss</code> 这个文件，存在则自动注入所有 sass 文件中，实现全局的样式变量的覆盖</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// @dcloudio/vue-cli-plugin-uni/index.js</span>
module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">api<span class="token punctuation">,</span> options</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  options<span class="token punctuation">.</span>css<span class="token punctuation">.</span>loaderOptions<span class="token punctuation">.</span>sass<span class="token punctuation">.</span>data <span class="token operator">=</span> <span class="token function">getPlatformScss</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 默认全局样式变量</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>fs<span class="token punctuation">.</span><span class="token function">existsSync</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">UNI_INPUT_DIR</span><span class="token punctuation">,</span> <span class="token string">'uni.scss'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    options<span class="token punctuation">.</span>css<span class="token punctuation">.</span>loaderOptions<span class="token punctuation">.</span>sass<span class="token punctuation">.</span>data <span class="token operator">=</span> <span class="token template-string"><span class="token string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token function">getPlatformScss</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">
@import &quot;@/uni.scss&quot;;`</span></span>
  <span class="token punctuation">}</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>webpack-preprocess-loader</li></ul> <p>该 loader 用于实现条件编译，uni-app 对几乎所有类型的文件均添加了这一 loader，使得代码的多端兼容极为便捷，其内部通过调用 <a href="https://github.com/jsoverson/preprocess" target="_blank" rel="noopener noreferrer">preprocess<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 这个库实现</p> <ul><li>webpack-uni-pages-loader</li></ul> <p>该 loader 作用于 <code>src/pages.json</code>，解析生成项目及各页面的 config，并配合 wrap-loader 将转换后的结果引入 <code>src/main.js</code> 中</p> <ul><li>wrap-loader</li></ul> <p>该 loader 作用于 <code>src/main.js</code>，自动引入各平台运行时兼容</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// @dcloudio/vue-cli-plugin-uni/index.js</span>
module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">api<span class="token punctuation">,</span> options</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  api<span class="token punctuation">.</span><span class="token function">configureWebpack</span><span class="token punctuation">(</span><span class="token parameter">webpackConfig</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
    <span class="token keyword">const</span> rules <span class="token operator">=</span> <span class="token punctuation">[</span>
      <span class="token comment">// ...</span>
      <span class="token punctuation">{</span>
        test<span class="token punctuation">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">UNI_INPUT_DIR</span><span class="token punctuation">,</span> <span class="token function">getMainEntry</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        use<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
          loader<span class="token punctuation">:</span> <span class="token string">'wrap-loader'</span><span class="token punctuation">,</span>
          options<span class="token punctuation">:</span> <span class="token punctuation">{</span>
            before<span class="token punctuation">:</span> <span class="token punctuation">[</span>
              process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">UNI_PLATFORM</span> <span class="token operator">===</span> <span class="token string">'h5'</span>
                <span class="token operator">?</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>useBuiltIns <span class="token operator">===</span> <span class="token string">'entry'</span> <span class="token operator">?</span> <span class="token template-string"><span class="token string">`import '@babel/polyfill';`</span></span> <span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">)</span> <span class="token operator">+</span>
                  <span class="token template-string"><span class="token string">`import 'uni-pages';import 'uni-</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">UNI_PLATFORM</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">';`</span></span><span class="token punctuation">)</span>
                <span class="token punctuation">:</span> <span class="token template-string"><span class="token string">`import 'uni-pages';`</span></span>
            <span class="token punctuation">]</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">]</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token comment">// ...</span>
    <span class="token punctuation">]</span>
</code></pre></div><h3 id="plugins"><a href="#plugins" aria-hidden="true" class="header-anchor">#</a> Plugins</h3> <ul><li><p>CopyWebpackPlugin 复制 static 文件夹到输出目录</p></li> <li><p>DefinePlugin 定义客户端侧全局常量 <code>process.env.UNI_ENV</code></p></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// @dcloudio/vue-cli-plugin-uni/index.js</span>
module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">api<span class="token punctuation">,</span> options</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  api<span class="token punctuation">.</span><span class="token function">chainWebpack</span><span class="token punctuation">(</span><span class="token parameter">webpackConfig</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
    webpackConfig
      <span class="token punctuation">.</span><span class="token function">plugin</span><span class="token punctuation">(</span><span class="token string">'uni-define'</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>require<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'webpack/lib/DefinePlugin'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
        <span class="token string">'process.env.UNI_ENV'</span><span class="token punctuation">:</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">UNI_PLATFORM</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="各端兼容"><a href="#各端兼容" aria-hidden="true" class="header-anchor">#</a> 各端兼容</h2> <h3 id="h5-2"><a href="#h5-2" aria-hidden="true" class="header-anchor">#</a> H5</h3> <ul><li>Alias</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// @dcloudio/vue-cli-plugin-uni/lib/h5/index.js</span>
<span class="token string">'vue-router'</span><span class="token punctuation">:</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'packages/h5-vue-router'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token string">'uni-h5'</span><span class="token punctuation">:</span> require<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'@dcloudio/uni-h5'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token string">'vue-style-loader'</span><span class="token punctuation">:</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'packages/h5-vue-style-loader'</span><span class="token punctuation">)</span>
</code></pre></div><ul><li>解析 pages.json 并转换为 vue-router 配置后挂在全局变量上，供运行时调用</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// @dcloudio/webpack-uni-pages-loader/lib/platforms/h5.js</span>
module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">pagesJson<span class="token punctuation">,</span> manifestJson</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token keyword">return</span> <span class="token template-string"><span class="token string">`  
import Vue from 'vue'
global.__uniConfig = </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>pagesJson<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">
global.__uniConfig.router = </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>h5<span class="token punctuation">.</span>router<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">;
global.__uniConfig['async'] = </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>h5<span class="token punctuation">[</span><span class="token string">'async'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">;  
global.__uniConfig.debug = </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>manifestJson<span class="token punctuation">.</span>debug <span class="token operator">===</span> <span class="token boolean">true</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">;
global.__uniConfig.networkTimeout = </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>networkTimeoutConfig<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">;
global.__uniConfig.sdkConfigs = </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>sdkConfigs<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">;
global.__uniConfig.qqMapKey = </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>qqMapKey<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">;
global.__uniConfig.nvue = </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token string">'flex-direction'</span><span class="token punctuation">:</span> <span class="token function">getFlexDirection</span><span class="token punctuation">(</span>manifestJson<span class="token punctuation">[</span><span class="token string">'app-plus'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">)}
</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token function">genRegisterPageVueComponentsCode</span><span class="token punctuation">(</span>pageComponents<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">
global.__uniRoutes=[</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token function">genPageRoutes</span><span class="token punctuation">(</span>pageComponents<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token function">genSystemRoutes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">','</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">]
`</span></span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>开发模式注入 reload 脚本</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// @dcloudio/vue-cli-plugin-uni/lib/h5/index.js</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">'production'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  plugins<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">WebpackHtmlAppendPlugin</span><span class="token punctuation">(</span>
    <span class="token template-string"><span class="token string">`
        &lt;script&gt;
        </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'./auto-reload.js'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'utf8'</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">
        &lt;/script&gt;
        `</span></span>
  <span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li><p>vue-cli-plugin-uni-optimize 专用于 h5 平台的优化插件</p></li> <li><p>CopyWebpackPlugin 复制 h5 平台兼容样式到输出目录的 static 文件夹中</p></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// @dcloudio/vue-cli-plugin-uni/index.js</span>
<span class="token keyword">function</span> <span class="token function">getCopyWebpackPluginOptions</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">UNI_PLATFORM</span> <span class="token operator">===</span> <span class="token string">'h5'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">appendCopyWebpackPluginOptions</span><span class="token punctuation">(</span>
      options<span class="token punctuation">,</span>
      require<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'@dcloudio/uni-h5/dist/index.css'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      assetsDir<span class="token punctuation">,</span> <span class="token punctuation">{</span>
        <span class="token function">transform</span> <span class="token punctuation">(</span><span class="token parameter">content</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">===</span> <span class="token string">'production'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> content <span class="token operator">+</span> <span class="token function">getShadowCss</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
          <span class="token punctuation">}</span>
          <span class="token keyword">return</span> content
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="小程序"><a href="#小程序" aria-hidden="true" class="header-anchor">#</a> 小程序</h3> <ul><li>重写 vue scoped，提供了对 scoped 更好的支持</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// @dcloudio/vue-cli-plugin-uni/lib/mp.js</span>
moduleAlias<span class="token punctuation">.</span><span class="token function">addAlias</span><span class="token punctuation">(</span><span class="token string">'./stylePlugins/scoped'</span><span class="token punctuation">,</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'./scoped.js'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><ul><li>添加 <code>mpvue-page-factory</code> 的 alias，通过对构建入口的处理注入，解决 <a href="https://github.com/Meituan-Dianping/mpvue/issues/140" target="_blank" rel="noopener noreferrer">mpvue#140<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 仅 mp-weixin</span>
<span class="token string">'mpvue-page-factory'</span><span class="token punctuation">:</span> require<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'@dcloudio/vue-cli-plugin-uni/packages/mpvue-page-factory'</span><span class="token punctuation">)</span>
</code></pre></div><ul><li>配置 <code>@dcloudio/webpack-uni-mp-loader</code> (构建入口的处理<a href="#%E5%85%B6%E4%BB%96%E5%B9%B3%E5%8F%B0">上文</a>已做介绍)</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// @dcloudio/vue-cli-plugin-uni/lib/mp.js</span>
rules<span class="token punctuation">:</span> <span class="token punctuation">[</span>
  <span class="token comment">// ...</span>
  <span class="token punctuation">{</span>
    resourceQuery<span class="token punctuation">:</span> <span class="token regex">/vue&amp;type=template/</span><span class="token punctuation">,</span>
    use<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
      loader<span class="token punctuation">:</span> <span class="token string">'@dcloudio/webpack-uni-mp-loader/lib/template'</span>
    <span class="token punctuation">}</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span>
</code></pre></div><ul><li>WebpackUniMPPlugin 调用 <code>emitFile</code> 生成构建好的文件</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// @dcloudio/vue-cli-plugin-uni/lib/mp.js</span>
<span class="token keyword">function</span> <span class="token function">createUniMPPlugin</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">UNI_USING_COMPONENTS</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> WebpackUniMPPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'@dcloudio/webpack-uni-mp-loader/lib/plugin/index-new'</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">WebpackUniMPPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">const</span> WebpackUniMPPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'@dcloudio/webpack-uni-mp-loader/lib/plugin'</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">WebpackUniMPPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li><a href="https://webpack.docschina.org/plugins/provide-plugin/" target="_blank" rel="noopener noreferrer">ProvidePlugin<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 注入 uni 等全局对象</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// @dcloudio/vue-cli-plugin-uni/lib/mp.js</span>
<span class="token keyword">function</span> <span class="token function">getProvides</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> uniPath <span class="token operator">=</span> require<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'@dcloudio/uni-'</span> <span class="token operator">+</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">UNI_PLATFORM</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> provides <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token string">'uni'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>uniPath<span class="token punctuation">,</span> <span class="token string">'default'</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">UNI_USING_COMPONENTS</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    provides<span class="token punctuation">[</span><span class="token string">'createApp'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>uniPath<span class="token punctuation">,</span> <span class="token string">'createApp'</span><span class="token punctuation">]</span>
    provides<span class="token punctuation">[</span><span class="token string">'createPage'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>uniPath<span class="token punctuation">,</span> <span class="token string">'createPage'</span><span class="token punctuation">]</span>
    provides<span class="token punctuation">[</span><span class="token string">'createComponent'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>uniPath<span class="token punctuation">,</span> <span class="token string">'createComponent'</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// TODO 目前依赖库 megalo 通过判断 wx 对象是否存在来识别平台做不同处理</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>
    process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">UNI_PLATFORM</span> <span class="token operator">!==</span> <span class="token string">'mp-qq'</span> <span class="token operator">&amp;&amp;</span>
        process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">UNI_PLATFORM</span> <span class="token operator">!==</span> <span class="token string">'mp-weixin'</span> <span class="token operator">&amp;&amp;</span>
        process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">UNI_PLATFORM</span> <span class="token operator">!==</span> <span class="token string">'app-plus'</span>
  <span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 非微信小程序，自动注入 wx 对象</span>
    provides<span class="token punctuation">[</span><span class="token string">'wx'</span><span class="token punctuation">]</span> <span class="token operator">=</span> provides<span class="token punctuation">[</span><span class="token string">'uni'</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> provides
<span class="token punctuation">}</span>
</code></pre></div><ul><li>CopyWebpackPlugin 复制各小程序平台原生自定义组件到输出目录，对应关系如下表</li></ul> <table><thead><tr><th style="text-align:center;">目录</th> <th style="text-align:center;">平台</th></tr></thead> <tbody><tr><td style="text-align:center;">wxcomponents</td> <td style="text-align:center;"><code>app-plus, mp-qq, mp-weixin</code></td></tr> <tr><td style="text-align:center;">swancomponents</td> <td style="text-align:center;"><code>mp-baidu</code></td></tr> <tr><td style="text-align:center;">mycomponents</td> <td style="text-align:center;"><code>mp-alipay</code></td></tr> <tr><td style="text-align:center;">ttcomponents</td> <td style="text-align:center;"><code>mp-toutiao</code></td></tr></tbody></table> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// @dcloudio/vue-cli-plugin-uni/index.js</span>
<span class="token keyword">function</span> <span class="token function">getCopyWebpackPluginOptions</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">UNI_PLATFORM</span> <span class="token operator">===</span> <span class="token string">'mp-baidu'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 百度原生小程序组件</span>
    <span class="token function">appendCopyWebpackPluginOptions</span><span class="token punctuation">(</span>
      options<span class="token punctuation">,</span>
      path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">UNI_INPUT_DIR</span><span class="token punctuation">,</span> <span class="token string">'swancomponents'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">UNI_OUTPUT_DIR</span><span class="token punctuation">,</span> <span class="token string">'swancomponents'</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>禁用热更新等浏览器端特性</li></ul> <h3 id="app-plus"><a href="#app-plus" aria-hidden="true" class="header-anchor">#</a> App Plus</h3> <ul><li>待补充</li></ul> <h2 id="总结"><a href="#总结" aria-hidden="true" class="header-anchor">#</a> 总结</h2> <p>uni-app 基于 vue-cli 对多端构建的配置进行了封装，很好地实现了不同平台间的兼容处理，使开发者的使用成本大幅降低，同时构建插件的文件结构及代码逻辑也都有很多值得学习之处</p> <p>文章内容如有疏漏或错误，敬请斧正。</p></div></article> <section class="post-meta main-div" data-v-4e23451f><section class="post-date clearfix" data-v-4e23451f><span class="create-date" data-v-4e23451f>
      发布时间 : 2019-08-03
    </span> <span class="update-date" data-v-4e23451f>
      最后修改 : 2019-08-07
    </span></section> <section class="post-links" data-v-4e23451f><a href="/posts/2019/07/22/interview-03.html" class="post-link" data-v-4e23451f>
      上一篇 : 前端 100 问 (三)
    </a> <a href="/posts/2019/08/07/interview-04.html" class="post-link" data-v-4e23451f>
      下一篇 : 前端 100 问 (四)
    </a></section></section> <div id="post-comments" class="main-div"><!----></div></div></main> <aside class="aside" data-v-6e91a59a><div class="info-card main-div" data-v-03c72fc4 data-v-6e91a59a><div class="info-card-header" data-v-03c72fc4><img src="https://avatars2.githubusercontent.com/u/16759376?s=460&amp;v=4" alt="徒言" class="info-avatar" data-v-03c72fc4></div> <div class="info-card-body" data-v-03c72fc4><section class="info-nickname" data-v-03c72fc4>
      徒言
    </section> <section class="info-desc" data-v-03c72fc4>Happy Coding<br/>Happy Life</section> <section class="info-contact" data-v-03c72fc4><section data-v-03c72fc4><span title="Tian'jin City, China" data-v-03c72fc4 data-v-03c72fc4><svg class="icon" style="font-size:1em;" data-v-03c72fc4 data-v-03c72fc4><title data-v-03c72fc4 data-v-03c72fc4>Tian'jin City, China</title><use xlink:href="#icon-location" data-v-03c72fc4 data-v-03c72fc4></use></svg><span class="info-text" data-v-03c72fc4 data-v-03c72fc4>
          Tian'jin City, China
        </span></span></section> <section data-v-03c72fc4><span title="Youngon" data-v-03c72fc4 data-v-03c72fc4><svg class="icon" style="font-size:1em;" data-v-03c72fc4 data-v-03c72fc4><title data-v-03c72fc4 data-v-03c72fc4>Youngon</title><use xlink:href="#icon-organization" data-v-03c72fc4 data-v-03c72fc4></use></svg><span class="info-text" data-v-03c72fc4 data-v-03c72fc4>
          Youngon
        </span></span></section> <section data-v-03c72fc4><a href="mailto:chaimaoyuan@foxmail.com" title="chaimaoyuan@foxmail.com" data-v-03c72fc4 data-v-03c72fc4><svg class="icon" style="font-size:1em;" data-v-03c72fc4 data-v-03c72fc4><title data-v-03c72fc4 data-v-03c72fc4>chaimaoyuan@foxmail.com</title><use xlink:href="#icon-email" data-v-03c72fc4 data-v-03c72fc4></use></svg><span class="info-text" data-v-03c72fc4 data-v-03c72fc4>
          chaimaoyuan@foxmail.com
        </span></a></section></section></div> <div class="info-card-footer" data-v-03c72fc4><section class="info-sns clearfix" data-v-03c72fc4><a href="https://github.com/F-loat" target="_blank" class="sns-link" data-v-03c72fc4><span title="GitHub: F-loat" class="sns-icon" data-v-03c72fc4 data-v-03c72fc4><svg class="icon" style="font-size:1.5em;" data-v-03c72fc4 data-v-03c72fc4><title data-v-03c72fc4 data-v-03c72fc4>GitHub: F-loat</title><use xlink:href="#icon-github" data-v-03c72fc4 data-v-03c72fc4></use></svg></span></a><a href="https://www.facebook.com/chaimaoyuan" target="_blank" class="sns-link" data-v-03c72fc4><span title="Facebook: chaimaoyuan" class="sns-icon" data-v-03c72fc4 data-v-03c72fc4><svg class="icon" style="font-size:1.5em;" data-v-03c72fc4 data-v-03c72fc4><title data-v-03c72fc4 data-v-03c72fc4>Facebook: chaimaoyuan</title><use xlink:href="#icon-facebook" data-v-03c72fc4 data-v-03c72fc4></use></svg></span></a><a href="http://www.linkedin.com/in/茂源-柴-a9b290115/" target="_blank" class="sns-link" data-v-03c72fc4><span title="LinkedIn: 柴茂源" class="sns-icon" data-v-03c72fc4 data-v-03c72fc4><svg class="icon" style="font-size:1.5em;" data-v-03c72fc4 data-v-03c72fc4><title data-v-03c72fc4 data-v-03c72fc4>LinkedIn: 柴茂源</title><use xlink:href="#icon-linkedin" data-v-03c72fc4 data-v-03c72fc4></use></svg></span></a><a href="https://twitter.com/chaimaoyuan" target="_blank" class="sns-link" data-v-03c72fc4><span title="Twitter: chaimaoyuan" class="sns-icon" data-v-03c72fc4 data-v-03c72fc4><svg class="icon" style="font-size:1.5em;" data-v-03c72fc4 data-v-03c72fc4><title data-v-03c72fc4 data-v-03c72fc4>Twitter: chaimaoyuan</title><use xlink:href="#icon-twitter" data-v-03c72fc4 data-v-03c72fc4></use></svg></span></a><a href="https://www.zhihu.com/people/F-loat" target="_blank" class="sns-link" data-v-03c72fc4><span title="知乎: F-loat" class="sns-icon" data-v-03c72fc4 data-v-03c72fc4><svg class="icon" style="font-size:1.5em;" data-v-03c72fc4 data-v-03c72fc4><title data-v-03c72fc4 data-v-03c72fc4>知乎: F-loat</title><use xlink:href="#icon-zhihu" data-v-03c72fc4 data-v-03c72fc4></use></svg></span></a><a href="https://www.instagram.com/chaimaoyuan" target="_blank" class="sns-link" data-v-03c72fc4><span title="Instagram: chaimaoyuan" class="sns-icon" data-v-03c72fc4 data-v-03c72fc4><svg class="icon" style="font-size:1.5em;" data-v-03c72fc4 data-v-03c72fc4><title data-v-03c72fc4 data-v-03c72fc4>Instagram: chaimaoyuan</title><use xlink:href="#icon-instagram" data-v-03c72fc4 data-v-03c72fc4></use></svg></span></a><a href="https://gitlab.com/F-loat" target="_blank" class="sns-link" data-v-03c72fc4><span title="GitLab: F-loat" class="sns-icon" data-v-03c72fc4 data-v-03c72fc4><svg class="icon" style="font-size:1.5em;" data-v-03c72fc4 data-v-03c72fc4><title data-v-03c72fc4 data-v-03c72fc4>GitLab: F-loat</title><use xlink:href="#icon-gitlab" data-v-03c72fc4 data-v-03c72fc4></use></svg></span></a></section></div></div> <div class="post-nav-card main-div" style="position:relative;top:0;width:0px;" data-v-6e91a59a><div class="post-nav-contents"><svg class="icon"><title>book</title><use xlink:href="#icon-book"></use></svg> <span>文章目录</span> <div class="post-nav-toc"><ul><li><a href="/posts/2019/08/03/uni-app-%E5%A4%9A%E7%AB%AF%E6%9E%84%E5%BB%BA%E5%8E%9F%E7%90%86%E6%B5%85%E6%9E%90.html#概述">概述</a></li><li><a href="/posts/2019/08/03/uni-app-%E5%A4%9A%E7%AB%AF%E6%9E%84%E5%BB%BA%E5%8E%9F%E7%90%86%E6%B5%85%E6%9E%90.html#项目结构">项目结构</a></li><li><a href="/posts/2019/08/03/uni-app-%E5%A4%9A%E7%AB%AF%E6%9E%84%E5%BB%BA%E5%8E%9F%E7%90%86%E6%B5%85%E6%9E%90.html#依赖说明">依赖说明</a></li><li><a href="/posts/2019/08/03/uni-app-%E5%A4%9A%E7%AB%AF%E6%9E%84%E5%BB%BA%E5%8E%9F%E7%90%86%E6%B5%85%E6%9E%90.html#构建命令">构建命令</a><ul><li><a href="/posts/2019/08/03/uni-app-%E5%A4%9A%E7%AB%AF%E6%9E%84%E5%BB%BA%E5%8E%9F%E7%90%86%E6%B5%85%E6%9E%90.html#uni-app-构建命令">uni-app 构建命令</a></li><li><a href="/posts/2019/08/03/uni-app-%E5%A4%9A%E7%AB%AF%E6%9E%84%E5%BB%BA%E5%8E%9F%E7%90%86%E6%B5%85%E6%9E%90.html#vue-cli-插件简介">vue-cli 插件简介</a></li></ul></li><li><a href="/posts/2019/08/03/uni-app-%E5%A4%9A%E7%AB%AF%E6%9E%84%E5%BB%BA%E5%8E%9F%E7%90%86%E6%B5%85%E6%9E%90.html#核心逻辑">核心逻辑</a></li><li><a href="/posts/2019/08/03/uni-app-%E5%A4%9A%E7%AB%AF%E6%9E%84%E5%BB%BA%E5%8E%9F%E7%90%86%E6%B5%85%E6%9E%90.html#构建入口">构建入口</a><ul><li><a href="/posts/2019/08/03/uni-app-%E5%A4%9A%E7%AB%AF%E6%9E%84%E5%BB%BA%E5%8E%9F%E7%90%86%E6%B5%85%E6%9E%90.html#h5">H5</a></li><li><a href="/posts/2019/08/03/uni-app-%E5%A4%9A%E7%AB%AF%E6%9E%84%E5%BB%BA%E5%8E%9F%E7%90%86%E6%B5%85%E6%9E%90.html#其他平台">其他平台</a></li></ul></li><li><a href="/posts/2019/08/03/uni-app-%E5%A4%9A%E7%AB%AF%E6%9E%84%E5%BB%BA%E5%8E%9F%E7%90%86%E6%B5%85%E6%9E%90.html#公共配置">公共配置</a><ul><li><a href="/posts/2019/08/03/uni-app-%E5%A4%9A%E7%AB%AF%E6%9E%84%E5%BB%BA%E5%8E%9F%E7%90%86%E6%B5%85%E6%9E%90.html#alias">Alias</a></li><li><a href="/posts/2019/08/03/uni-app-%E5%A4%9A%E7%AB%AF%E6%9E%84%E5%BB%BA%E5%8E%9F%E7%90%86%E6%B5%85%E6%9E%90.html#loaders">Loaders</a></li><li><a href="/posts/2019/08/03/uni-app-%E5%A4%9A%E7%AB%AF%E6%9E%84%E5%BB%BA%E5%8E%9F%E7%90%86%E6%B5%85%E6%9E%90.html#plugins">Plugins</a></li></ul></li><li><a href="/posts/2019/08/03/uni-app-%E5%A4%9A%E7%AB%AF%E6%9E%84%E5%BB%BA%E5%8E%9F%E7%90%86%E6%B5%85%E6%9E%90.html#各端兼容">各端兼容</a><ul><li><a href="/posts/2019/08/03/uni-app-%E5%A4%9A%E7%AB%AF%E6%9E%84%E5%BB%BA%E5%8E%9F%E7%90%86%E6%B5%85%E6%9E%90.html#h5-2">H5</a></li><li><a href="/posts/2019/08/03/uni-app-%E5%A4%9A%E7%AB%AF%E6%9E%84%E5%BB%BA%E5%8E%9F%E7%90%86%E6%B5%85%E6%9E%90.html#小程序">小程序</a></li><li><a href="/posts/2019/08/03/uni-app-%E5%A4%9A%E7%AB%AF%E6%9E%84%E5%BB%BA%E5%8E%9F%E7%90%86%E6%B5%85%E6%9E%90.html#app-plus">App Plus</a></li></ul></li><li><a href="/posts/2019/08/03/uni-app-%E5%A4%9A%E7%AB%AF%E6%9E%84%E5%BB%BA%E5%8E%9F%E7%90%86%E6%B5%85%E6%9E%90.html#总结">总结</a></li></ul></div></div> <div class="post-nav-comments"><svg class="icon"><title>comment</title><use xlink:href="#icon-comment"></use></svg> <a href="/posts/2019/08/03/uni-app-%E5%A4%9A%E7%AB%AF%E6%9E%84%E5%BB%BA%E5%8E%9F%E7%90%86%E6%B5%85%E6%9E%90.html#post-comments">
      评论
    </a></div></div></aside></div> <footer class="footer" data-v-1114308c><p class="sns-links" data-v-1114308c><a href="https://github.com/F-loat" target="_blank" class="sns-link" data-v-1114308c><span title="GitHub: F-loat" class="sns-icon" data-v-1114308c data-v-1114308c><svg class="icon" style="font-size:25px;" data-v-1114308c data-v-1114308c><title data-v-1114308c data-v-1114308c>GitHub: F-loat</title><use xlink:href="#icon-github" data-v-1114308c data-v-1114308c></use></svg></span></a><a href="https://www.facebook.com/chaimaoyuan" target="_blank" class="sns-link" data-v-1114308c><span title="Facebook: chaimaoyuan" class="sns-icon" data-v-1114308c data-v-1114308c><svg class="icon" style="font-size:25px;" data-v-1114308c data-v-1114308c><title data-v-1114308c data-v-1114308c>Facebook: chaimaoyuan</title><use xlink:href="#icon-facebook" data-v-1114308c data-v-1114308c></use></svg></span></a><a href="http://www.linkedin.com/in/茂源-柴-a9b290115/" target="_blank" class="sns-link" data-v-1114308c><span title="LinkedIn: 柴茂源" class="sns-icon" data-v-1114308c data-v-1114308c><svg class="icon" style="font-size:25px;" data-v-1114308c data-v-1114308c><title data-v-1114308c data-v-1114308c>LinkedIn: 柴茂源</title><use xlink:href="#icon-linkedin" data-v-1114308c data-v-1114308c></use></svg></span></a><a href="https://twitter.com/chaimaoyuan" target="_blank" class="sns-link" data-v-1114308c><span title="Twitter: chaimaoyuan" class="sns-icon" data-v-1114308c data-v-1114308c><svg class="icon" style="font-size:25px;" data-v-1114308c data-v-1114308c><title data-v-1114308c data-v-1114308c>Twitter: chaimaoyuan</title><use xlink:href="#icon-twitter" data-v-1114308c data-v-1114308c></use></svg></span></a><a href="https://www.zhihu.com/people/F-loat" target="_blank" class="sns-link" data-v-1114308c><span title="知乎: F-loat" class="sns-icon" data-v-1114308c data-v-1114308c><svg class="icon" style="font-size:25px;" data-v-1114308c data-v-1114308c><title data-v-1114308c data-v-1114308c>知乎: F-loat</title><use xlink:href="#icon-zhihu" data-v-1114308c data-v-1114308c></use></svg></span></a><a href="https://www.instagram.com/chaimaoyuan" target="_blank" class="sns-link" data-v-1114308c><span title="Instagram: chaimaoyuan" class="sns-icon" data-v-1114308c data-v-1114308c><svg class="icon" style="font-size:25px;" data-v-1114308c data-v-1114308c><title data-v-1114308c data-v-1114308c>Instagram: chaimaoyuan</title><use xlink:href="#icon-instagram" data-v-1114308c data-v-1114308c></use></svg></span></a><a href="https://gitlab.com/F-loat" target="_blank" class="sns-link" data-v-1114308c><span title="GitLab: F-loat" class="sns-icon" data-v-1114308c data-v-1114308c><svg class="icon" style="font-size:25px;" data-v-1114308c data-v-1114308c><title data-v-1114308c data-v-1114308c>GitLab: F-loat</title><use xlink:href="#icon-gitlab" data-v-1114308c data-v-1114308c></use></svg></span></a></p> <p data-v-1114308c><span data-v-1114308c>Powered by </span> <a href="https://vuepress.vuejs.org" target="_blank" data-v-1114308c>
      Vuepress
    </a></p></footer></div><div class="global-ui"><!----><!----></div></div>
    <script src="/assets/js/app.13c773d0.js" defer></script><script src="/assets/js/7.aa338464.js" defer></script><script src="/assets/js/19.87719627.js" defer></script>
  </body>
</html>
